{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}模板统计 - {{ site_title|default:"Django site admin" }}{% endblock %}

{% block extra_css %}
<style>
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .stats-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stats-card h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #007cba;
        padding-bottom: 10px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    
    .stat-item {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
    }
    
    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #007cba;
        display: block;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9em;
        margin-top: 5px;
    }
    
    .progress-bar {
        background: #ddd;
        border-radius: 10px;
        height: 20px;
        margin: 5px 0;
        overflow: hidden;
    }
    
    .progress-fill {
        background: linear-gradient(90deg, #007cba, #005a87);
        height: 100%;
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 8px;
        color: white;
        font-size: 0.8em;
    }
    
    .language-item, .creator-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }
    
    .language-item:last-child,
    .creator-item:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">首页</a>
    &rsaquo; <a href="{% url 'admin:problems_globaltemplate_changelist' %}">全局模板</a>
    &rsaquo; 统计信息
</div>
{% endblock %}

{% block content %}
<h1>模板统计信息</h1>

<div class="stats-container">
    <!-- 总体统计 -->
    <div class="stats-card">
        <h3><i class="fas fa-chart-bar"></i> 总体统计</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-number">{{ total_count }}</span>
                <div class="stat-label">总模板数</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ active_count }}</span>
                <div class="stat-label">活跃模板</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ inactive_count }}</span>
                <div class="stat-label">停用模板</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ language_stats|length }}</span>
                <div class="stat-label">支持语言</div>
            </div>
        </div>
    </div>
    
    <!-- 语言分布 -->
    <div class="stats-card">
        <h3><i class="fas fa-code"></i> 语言分布</h3>
        {% for stat in language_stats %}
        <div class="language-item">
            <div>
                <strong>{{ stat.language|upper }}</strong>
            </div>
            <div style="flex: 1; margin: 0 15px;">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% widthratio stat.count total_count 100 %}%">
                        {{ stat.count }}
                    </div>
                </div>
            </div>
            <div>
                {% widthratio stat.count total_count 100 %}%
            </div>
        </div>
        {% empty %}
        <p class="text-muted">暂无数据</p>
        {% endfor %}
    </div>
    
    <!-- 创建者排行 -->
    <div class="stats-card">
        <h3><i class="fas fa-users"></i> 活跃创建者 (TOP 10)</h3>
        {% for stat in creator_stats %}
        <div class="creator-item">
            <div>
                <strong>{{ stat.creator__username }}</strong>
            </div>
            <div style="flex: 1; margin: 0 15px;">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% widthratio stat.count creator_stats.0.count 100 %}%">
                        {{ stat.count }}
                    </div>
                </div>
            </div>
            <div>
                {{ stat.count }} 个
            </div>
        </div>
        {% empty %}
        <p class="text-muted">暂无数据</p>
        {% endfor %}
    </div>
    
    <!-- 活跃状态分布 -->
    <div class="stats-card">
        <h3><i class="fas fa-toggle-on"></i> 状态分布</h3>
        <div class="language-item">
            <div>
                <strong style="color: #28a745;">活跃模板</strong>
            </div>
            <div style="flex: 1; margin: 0 15px;">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% widthratio active_count total_count 100 %}%; background: #28a745;">
                        {{ active_count }}
                    </div>
                </div>
            </div>
            <div>
                {% widthratio active_count total_count 100 %}%
            </div>
        </div>
        <div class="language-item">
            <div>
                <strong style="color: #dc3545;">停用模板</strong>
            </div>
            <div style="flex: 1; margin: 0 15px;">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% widthratio inactive_count total_count 100 %}%; background: #dc3545;">
                        {{ inactive_count }}
                    </div>
                </div>
            </div>
            <div>
                {% widthratio inactive_count total_count 100 %}%
            </div>
        </div>
    </div>
</div>

<div style="margin-top: 30px;">
    <a href="{% url 'admin:problems_globaltemplate_changelist' %}" class="btn btn-primary">
        <i class="fas fa-arrow-left"></i> 返回模板列表
    </a>
    <a href="{% url 'admin:problems_globaltemplate_import' %}" class="btn btn-success">
        <i class="fas fa-upload"></i> 导入模板
    </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 动画效果
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 100);
    });
});
</script>
{% endblock %}
